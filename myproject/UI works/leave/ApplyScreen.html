<!DOCTYPE html>
<html lang="en">

<head>
  <title>Leave Apply</title>
  <meta charset="utf-8">


  <!--  jQuery -->

  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <link rel="stylesheet" type="text/css" href="../stylesheet/bootstrap.min.css">

  <!-- Bootstrap Date-Picker Plugin -->
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script> -->
</head>
<script type="text/javascript">
  var base_url = "http://127.0.0.1:8000/leave/";
  // var user = sessionStorage.getItem('user')
  // var id = "&id="+user
  var userid = geturl();
  alert(userid.id);
  var id = "&id=" + userid.id;

  function geturl(varname) {
    var url = window.location.href;
    var vars = {}
    var hashes = url.split("?")[1];
    var hash = hashes.split("&");
    for (i = 0; i < hash.length; i++) {
      params = hash[i].split("=");
      vars[params[0]] = params[1];
    } return vars;
  }

  $(document).ready(function () {
    $.ajax({
      type: "GET",
      dataType: "json",
      url: base_url + "employee/?format=json" + id,
      success: function (data) {
        $.each(data, function (index, data) {
          $("#name").val(data.name);
          $("#reporter").val(data.reporting_senior.name);
        });
      }
    });
    $('.datepicker').datepicker({
      dateFormat: 'yy-mm-dd'
    });
    $.ajax({
      type: "GET",
      dataType: "json",
      url: base_url + "types/?format=json",
      success: function (data) {
        $.each(data, function (index, result) {
          var credit = "<option>" + result.catagory + "</option>";
          $(credit).appendTo('.selectpicker');
        });
      }
    });
  });

  function apply() {
    var data = new Array();
    data[0] = $("#name").val();
    data[1] = $("#type").val();
    data[2] = $("#fromDate").val();
    data[3] = $("#toDate").val();
    data[4] = $("#reason").val();
    console.log(data[4]);
    console.log(data);
    $.ajax({
      type: "POST",
      url: base_url + "apply/",
      data: JSON.stringify({
        "name": data[0],
        "leave_type": data[1],
        "from_date": data[2],
        "to_date": data[3],
        "reason": data[4]
      }),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function (result) {
        alert("Your Leave Applied");
      },
      error: function (result) {
        alert("fail");
        console.log(result);
      }
    });
  }
</script>
</head>

<body>
  <div class="jumbotron" style="font-family:Georgia">
    <h2 class="text-center" for="example-text-input" value="name">Leave Application</h2>
    <p class="text-center"> Leave Apply Form
      <p>
  </div>
  <form id="form" role="form" data-toggle="validator">
    <div class="container">
      <div class="row">
        <label class=" col-md-2">Name:</label>
        <input type="text" class="form-control col-md-4" id="name" readonly>
        <label class=" col-md-2">Reporting Senior:</label>
        <input type="text" class="form-control col-md-4" id="reporter" readonly>
      </div>
      <br/>
      <div class="row">
          <label class="col-md-2">From date:</label>
          <input class="datepicker form-control col-md-4" id='fromDate' data-date-format="yyyy/mm/dd">
          <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
          </span>
          <label class=" col-md-2">To date:</label>
            <input class="datepicker form-control col-md-4" id='toDate'>
            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
            </span>
      </div>
          <br/>
      <div class="row">
        <label class="col-md-2">Select leave:</label>
        <select name="selValue" class="selectpicker" id="type">
          <option value="select" class="form-control">select leave</option>
        </select>
      </div>
      <!-- <div class="form-group">
        <div class="col-md-9 col-md-offset-3">
            <div id="messages"></div>
        </div>
    </div> -->
      <br/>
      <div class="row">
        <label class="col-md-2">Reason:</label><br>
        <textarea class="col-md-4" rows="4" style="resize:none" cols="70" id="reason" name="comment" placeholder="Reason"> </textarea>
        <!-- <input type="text" class="form-control" id="reason"> -->
      </div>
      <br>
      <center>
        <input class="btn btn-success" value="Apply" onclick="apply()">
      </center>
    </div>
  </form>
</body>
</html>
