
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Leave Apply</title>
    <meta charset="utf-8">


    <!--  jQuery -->

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" type="text/css" href="../stylesheet/bootstrap.min.css">

<script type="text/javascript">
  var base_url = "http://127.0.0.1:8000/leave/"; 
  var user = sessionStorage.getItem('user')
  var id = "&id="+user

    $(document).ready(function() {

      $( "#datepicker" ).datepicker();

       $.ajax({
        type: "GET",
        dataType: "json",
        url:  base_url+"employee/?format=json"+id,
        success: function(data) { 
          $.each(data, function(index, data){
              $("#name").val(data.name);
              $("#reporter").val(data.reporting_senior.name);
          });
        }
      });
       $('.datepicker').datepicker({
        dateFormat: 'yy-mm-dd'
       });

      function back(){
        window.location='index.html?userid='+id
      }

      $.ajax({
      type : "GET",
      dataType : "json",
      url: base_url+"types/?format=json",
      success : function(data){
        $.each(data, function(index, result){
          var credit="<option>"+result.catagory +"</option>";
          $(credit).appendTo('.selectpicker');
        });
      }
    });
    });

    function apply() {
        var data = new Array();
        data[0] = $("#name").val(); 
        data[1] = $("#type").val();
        data[2] = $("#fromDate").val();
        data[3] = $("#toDate").val();  
        data[4] = $("#reason").val();
        
        alert(data); 
        $.ajax({
          type: "POST",
          url:  base_url+"apply/",
          data: JSON.stringify({ 
            "name": data[0],
            "leave_type":data[1],
            "from_date":data[2],
            "to_date":data[3], 
            "reason": data[4] 
          }),
          contentType: "application/json; charset=utf-8",
          dataType: "json",
          success: function (result) {
            alert("Your Leave Applied");
          },
          error: function (result) {
            console.log(result);
          }
        });

      }
</script>
</head>
  <body>
    <center>
    <div class="jumbotron" style="font-family:Georgia">
        <h2 class ="text-center" for="example-text-input" value="name">Leave Application</h2>
        <p class ="text-center"> Leave Apply Form<p>    
  </div>
  <form>
    <div class="container">
      <div class="form-group">
        <div class="form-row">
          <label class="text-center">Name:</label>
          <input type="text" class="form-control" id="name">
        </div>
      </div>
      <div class="form-row">
        <label  class="text-center">Reporting Senior:</label>
        <input type="text" class="form-control" id="reporter" >
      </div>

      <div class="form-row">
        <div class="form-group col-md-6">
          
              <label class="text-center">From date:</label>
              <input class="datepicker form-control" id='fromDate' data-date-format="yyyy/mm/dd">
              <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
              </span>
          
        </div>
        <div class="form-group col-md-6"> 
            <label class="text-center">To date:</label>
            <div class="input-group date" data-provide="datepicker">
              <input class="datepicker form-control" id='toDate'>
              <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
              </span>
            </div>
        </div>
      </div>
      <div class="form-row">
        <label class="text-center">Select leave:</label>
        <select name="selValue" class="selectpicker" id="type">
          <option value="select" class="form-control">select leave</option>
        </select>
      </div>
      <div class="form-row">
        <label>Reason:</label>
        <input type="text" class="form-control" id="reason">
      </div>
      <br>
      <center>
        <input class="btn btn-success" value="Apply" onclick="apply()">
        <input class="btn btn-danger" onclick="back()" value="Back">
      </center>
    </div>   
  </form>
</body>
</html>
